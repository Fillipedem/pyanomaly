---

title: timeseries

keywords: fastai
sidebar: home_sidebar

summary: "Módulo com implementação de algoritmos para detecção de **anomalias em series temporais**."
description: "Módulo com implementação de algoritmos para detecção de **anomalias em series temporais**."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_timeseries.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="factory_atype" class="doc_header"><code>factory_atype</code><a href="https://github.com/fillipedem/pyanomaly/tree/master/pyanomaly/timeseries.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>factory_atype</code>(<strong><code>atype</code></strong>=<em><code>'mad'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Moving-Average">Moving Average<a class="anchor-link" href="#Moving-Average"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="moving_average" class="doc_header"><code>moving_average</code><a href="https://github.com/fillipedem/pyanomaly/tree/master/pyanomaly/timeseries.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>moving_average</code>(<strong><code>ts</code></strong>, <strong><code>window</code></strong>=<em><code>12</code></em>, <strong><code>atype</code></strong>=<em><code>'mad'</code></em>)</p>
</blockquote>
<p>Detecção de anomalias com base no Moving Average da serie tempora(ts).
ts = numpy array      - serie temporal
window_size = [2..n]  - Tamanho da janela
atype = ['mad', 'tukey'] - algoritmo para detecção de anomalias</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="moving_average_score" class="doc_header"><code>moving_average_score</code><a href="https://github.com/fillipedem/pyanomaly/tree/master/pyanomaly/timeseries.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>moving_average_score</code>(<strong><code>ts</code></strong>, <strong><code>window</code></strong>=<em><code>12</code></em>, <strong><code>atype</code></strong>=<em><code>'mad'</code></em>)</p>
</blockquote>
<p>Detecção de anomalias com base no Moving Average da serie tempora(ts).
ts = numpy array      - serie temporal
window_size = [2..n]  - Tamanho da janela
atype = ['mad', 'tukey'] - algoritmo para detecção de anomalias</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Twitter">Twitter<a class="anchor-link" href="#Twitter"> </a></h2><p>O algoritmo popularizado pelo Twitter é um conjunto como o <strong>Seasonal Hybrid ESD (S-H-ESD)</strong>  que funciona em cima do <strong>Generalized ESD test</strong> para detecção de anomalias. S-H-ESD pode ser utilizado tanto para detecção local ou global de anomalias. O método envolvi decompor a serie temporal e utilizar métodos robustos para detecção de anomalias(MAD).</p>
<p>Já existe a implementação fornecida pelo <strong>Twitter</strong> na linguagem <strong>R</strong>, a seguir temos a implementação do algoritmo feita em Python.</p>
<p>Artigo: <a href="https://arxiv.org/pdf/1704.07706.pdf">https://arxiv.org/pdf/1704.07706.pdf</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="twitter" class="doc_header"><code>twitter</code><a href="__main__.py#L4" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>twitter</code>(<strong><code>x</code></strong>, <strong><code>m</code></strong>=<em><code>3.0</code></em>, <strong><code>period</code></strong>=<em><code>None</code></em>, <strong><code>seasonal</code></strong>=<em><code>45</code></em>, <strong><code>only_low_values</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Retorna os index dos valores que são anomalias
input precisa ser um Serie com DateTimeIndex</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="twitter_score" class="doc_header"><code>twitter_score</code><a href="__main__.py#L4" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>twitter_score</code>(<strong><code>x</code></strong>, <strong><code>m</code></strong>=<em><code>3.0</code></em>, <strong><code>period</code></strong>=<em><code>None</code></em>, <strong><code>seasonal</code></strong>=<em><code>45</code></em>)</p>
</blockquote>
<p>Retorna os index dos valores que são anomalias
input precisa ser um Serie com index temporal</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Teste">Teste<a class="anchor-link" href="#Teste"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./dados/rec-center-hourly.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>kw_energy_consumption</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-07-02 00:00:00</th>
      <td>21.2</td>
    </tr>
    <tr>
      <th>2010-07-02 01:00:00</th>
      <td>16.4</td>
    </tr>
    <tr>
      <th>2010-07-02 02:00:00</th>
      <td>4.7</td>
    </tr>
    <tr>
      <th>2010-07-02 03:00:00</th>
      <td>4.7</td>
    </tr>
    <tr>
      <th>2010-07-02 04:00:00</th>
      <td>4.6</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">twitter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;kw_energy_consumption&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>datetime
2010-07-03 18:00:00    11.6
2010-07-03 19:00:00     5.3
2010-07-03 20:00:00     5.4
2010-07-04 06:00:00     5.2
2010-07-04 07:00:00     5.6
                       ... 
2010-12-30 17:00:00    60.7
2010-12-30 18:00:00    55.2
2010-12-31 05:00:00    60.8
2010-12-31 09:00:00    83.1
2010-12-31 10:00:00    75.7
Name: kw_energy_consumption, Length: 346, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">anomalies</span> <span class="o">=</span> <span class="n">twitter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;kw_energy_consumption&#39;</span><span class="p">],</span> <span class="n">only_low_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">anomalies</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>datetime
2010-07-04 07:00:00    5.6
2010-07-18 07:00:00    5.5
2010-11-06 18:00:00    5.2
2010-11-07 18:00:00    5.3
2010-11-13 18:00:00    5.4
2010-11-14 18:00:00    5.4
2010-11-20 18:00:00    6.2
2010-11-21 18:00:00    6.2
2010-11-27 18:00:00    5.5
2010-11-28 06:00:00    8.7
2010-11-28 18:00:00    5.4
2010-12-04 18:00:00    5.4
2010-12-05 06:00:00    8.9
2010-12-05 18:00:00    5.3
2010-12-25 17:00:00    5.7
2010-12-26 16:00:00    6.0
2010-12-26 17:00:00    5.5
Name: kw_energy_consumption, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

